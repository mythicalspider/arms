echo "Running tests..."

unalias fail &>/dev/null
alias fail='{ returnValue=1; break; }'
# should be placed after any loop inside of an exception catching block
unalias maybeBreak &>/dev/null
alias maybeBreak='[ $returnValue == 0 ] || break;'

RED=$'\033[01;31m'
GREEN=$'\033[01;32m'
RESET=$'\033[0m'

test_result_path=$build_folder/test_results
rm $test_result_path &>/dev/null

unset executeTests
executeTests() {
  local path="$1" file dir returnValue=0
  for file in $(find $path -mindepth 1 -maxdepth 1 -type f -printf "%f\n" | sort); do
    echo -n "$file: "
    source $path/$file >>$test_result_path || {
      echo "${RED}[Failed]${RESET}"
      fail
    }
    echo "${GREEN}[Success]${RESET}"
  done
  
  for dir in $(find $path -mindepth 1 -maxdepth 1 -type d | sort); do
    executeTests "$dir" || fail
  done

  return $returnValue
}

executeTests $build_folder/tests || exit 1

